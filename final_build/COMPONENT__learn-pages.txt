# Component: `src/lib/learn-pages.ts`

Purpose:
- Centralize shared learn-catalog derivations and CTA/proof helpers for learn-style pages.
- Provide reusable, low-risk helpers so `/workshops` and `/visual-classes` keep identical behavior where intended.

Inputs:
- `Module[]` from `src/lib/schemas.ts`.
- `Workshop[]` from `src/lib/schemas.ts`.
- Helpers from `src/lib/workshop-catalog.ts`, `src/lib/link-utils.ts`.

Outputs:
- Normalized card models for:
  - Visual class catalog (`getVisualClassCatalog`)
  - Core workshop catalog (`getCoreWorkshopCatalog`)
  - Replay quick links (`getWorkshopReplayLinks`)
  - Slides quick links (`getWorkshopSlideLinks`)
- Shared proof snippets and CTA logic:
  - `buildModuleProofSnippet`
  - `buildWorkshopProofSnippet`
  - `buildModuleCta`
  - `buildWorkshopCta`
  - Sequenced proof narration for `/visual-classes` that shows learning progression.
- Module slide preference:
  - `resolveVisualClassModuleSlideHref` resolves `module.links.slides` as the primary module deck destination when present.
  - If no valid slide link is present, module cards fall back to module CTA defaults.
- Visual-class sequencing now uses an explicit curriculum map:
  `VISUAL_CLASS_DECK_SEQUENCE` in `src/lib/learn-pages.ts`.
- Current `/visual-classes` deck scope is focused on the nine provided slide-linked modules and excludes older placeholder/legacy module entries.
- Extended `LearnCard` with lesson metadata and optional slide metadata:
  - `description`, `lessonIndex`, `lessonLabel`, `slidesHref`, `slidesLabel`
  - `getVisualClassCatalog()` is now modules-only (workshop mixing removed) and assigns deterministic lesson numbering (Lesson 1, Lesson 2, â€¦) to every rendered card so curriculum progression is explicit and continuous.
  - Module cards prefer `module.lessonTitle` and `module.lessonDescription` for plain-language presentation, with fallback to existing proof-derived snippets when those fields are missing.
  - Slide links for visual-class cards now prefer `slidesUrl` and fall back to `replayUrl`; those links are currently surfaced through each card's primary CTA/pattern, with no separate slide rail section.
- `getVisualClassCatalog()` uses `module.links.slides` in the `/visual-classes` catalog so lesson cards can point directly to curated module decks when configured in content.
- Visual-class cards are filtered to curated deck IDs first. If an ID is not in the curriculum map, it is excluded (so legacy or non-linked modules are not rendered on `/visual-classes`).

State:
- No persisted state; deterministic array transforms for each call.

Edge cases:
- Non-displayable visual-class modules are excluded.
- Invalid placeholder links are filtered from replay/slides lists.
- Empty proof content falls back to sensible defaults.
- Visual-class catalog entries are sorted by explicit learning sequence keys (with stable id fallback) and stitched into a dependency-aware proof chain.
- Lesson labels are emitted even when card proof chaining is not meaningful (fallback preserves card count visibility).
- Slide helper export (`getVisualClassSlides`) removed; slide/link metadata remains in `LearnCard` for per-card actions.
- Module CTA selection now prefers slides/deck links and only falls back to module `cta` defaults when no curated or explicit slide link exists.
- Description progression preserves readability: if a description does not already start with "Builds on", continuity text is added from the previous lesson title.

Dependencies:
- `src/lib/workshop-catalog.ts`
- `src/lib/link-utils.ts`
- `src/lib/schemas.ts`

Acceptance checks:
- Core/visual workshop classification remains aligned with `splitWorkshops`.
- CTAs and proof snippets are rendered with the same precedence on both learn routes.
