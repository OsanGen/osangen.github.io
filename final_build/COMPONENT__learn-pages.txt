# Component: `src/lib/learn-pages.ts`

Purpose:
- Centralize shared learn-catalog derivations and CTA/proof helpers for learn-style pages.
- Provide reusable, low-risk helpers so `/workshops` and `/visual-classes` keep identical behavior where intended.

Inputs:
- `Module[]` from `src/lib/schemas.ts`.
- `Workshop[]` from `src/lib/schemas.ts`.
- Helpers from `src/lib/workshop-catalog.ts`, `src/lib/link-utils.ts`.

Outputs:
- Normalized card models for:
  - Visual class catalog (`getVisualClassCatalog`)
  - Core workshop catalog (`getCoreWorkshopCatalog`)
  - Replay quick links (`getWorkshopReplayLinks`)
  - Slides quick links (`getWorkshopSlideLinks`)
- Shared proof snippets and CTA logic:
  - `buildModuleProofSnippet`
  - `buildWorkshopProofSnippet`
  - `buildModuleCta`
  - `buildWorkshopCta`
  - Sequenced proof narration for `/visual-classes` that shows learning progression.
- Visual-class sequencing now uses an explicit curriculum map:
  `VISUAL_CLASS_DECK_SEQUENCE` in `src/lib/learn-pages.ts`.
- Extended `LearnCard` with lesson metadata and optional slide metadata:
  - `lessonIndex`, `lessonLabel`, `slidesHref`, `slidesLabel`
- `getVisualClassCatalog()` now assigns deterministic lesson numbering (Lesson 1, Lesson 2, â€¦) to rendered cards so the curriculum progression is explicit.
- Slide links for visual-class cards now prefer `slidesUrl` and fall back to `replayUrl`; those links are currently surfaced through each card's primary CTA/pattern, with no separate slide rail section.
- Visual-class cards are filtered to curated deck IDs first; if no curated IDs are present, behavior falls back to the previous global visual-class ordering.

State:
- No persisted state; deterministic array transforms for each call.

Edge cases:
- Non-displayable visual-class modules are excluded.
- Invalid placeholder links are filtered from replay/slides lists.
- Empty proof content falls back to sensible defaults.
- Visual-class catalog entries are sorted by explicit learning sequence keys (with stable id fallback) and stitched into a dependency-aware proof chain.
- Lesson labels are emitted even when card proof chaining is not meaningful (fallback preserves card count visibility).
- Slide helper export (`getVisualClassSlides`) removed; slide/link metadata remains in `LearnCard` for per-card actions.

Dependencies:
- `src/lib/workshop-catalog.ts`
- `src/lib/link-utils.ts`
- `src/lib/schemas.ts`

Acceptance checks:
- Core/visual workshop classification remains aligned with `splitWorkshops`.
- CTAs and proof snippets are rendered with the same precedence on both learn routes.
