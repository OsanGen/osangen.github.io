---
import BaseLayout from '../layouts/BaseLayout.astro';
import { isUnavailableLink, sanitizeLink } from '../lib/link-utils';
import joinProject from '../content/data/join_project.json';

const {
  eyebrow,
  title,
  lede,
  highLevelScopeTitle,
  scopeChips,
  impactTitle,
  impactOneLiner,
  ctaLabel,
  ctaHref,
} = joinProject;

const resolvedCtaHref = sanitizeLink(ctaHref || '');
const isApplyPlaceholder = resolvedCtaHref === 'INTERNSHIP_APPLY_URL';
const hasPrimaryCta = resolvedCtaHref && !isUnavailableLink(resolvedCtaHref) && !isApplyPlaceholder;

const visibleChips = scopeChips?.slice(0, 6) ?? [];
---
<BaseLayout title="Contribute - Oscar Sanchez" description="Beginner-friendly contribution path to upskill in AI literacy and GenAI marketing, then teach underserved communities.">
  <div class="join-landing scene-shell">
    <section class="hero-shell cog-proof-stack" data-motion-enter>
      <p class="hero-eyebrow">{eyebrow}</p>
      <h1>{title}</h1>
      <p class="join-lede">{lede}</p>
      <div class="join-cta-stack">
        <div class="join-cta-row">
          {hasPrimaryCta ? (
            <a
              class="button button--primary join-cta"
              href={resolvedCtaHref}
              target="_blank"
              rel="noopener noreferrer"
              aria-label="Apply to contribute (opens in new tab)"
            >
              {ctaLabel}
            </a>
          ) : (
            <p class="text-small muted join-cta-fallback">Application link unavailable. Check back soon.</p>
          )}
        </div>
      </div>
    </section>

    <section class="panel-shell" data-motion-enter>
      <h2 class="join-panel-title">{highLevelScopeTitle}</h2>
      <div class="join-scope-grid" aria-label="Scope chips">
        {visibleChips.map((chip) => (
          <span class="proof-chip">{chip}</span>
        ))}
      </div>
      <p class="join-impact-label">{impactTitle}</p>
      <p class="join-impact">{impactOneLiner}</p>
    </section>
  </div>
</BaseLayout>

<style>
  .join-landing {
    display: grid;
    grid-template-columns: minmax(0, 1.16fr) minmax(320px, 0.84fr);
    gap: clamp(0.9rem, 2vw, 1.45rem);
    align-items: stretch;
    max-width: min(1120px, calc(100vw - 2rem));
    margin: 0 auto;
  }

  .join-landing .hero-shell {
    padding: clamp(1.45rem, 2.8vw, 2.4rem);
    display: grid;
    align-content: start;
    gap: clamp(0.52rem, 1.2vw, 0.9rem);
    min-height: 100%;
  }

  .join-landing .hero-shell::before {
    top: clamp(-5.4rem, -8vw, -3.8rem);
    right: clamp(-6.6rem, -10vw, -4.8rem);
    opacity: 0.42;
  }

  .join-landing .hero-shell::after {
    right: 1rem;
    bottom: 1rem;
  }

  .join-landing .hero-eyebrow {
    margin: 0;
    font-size: 0.78rem;
    letter-spacing: 0.08em;
    text-transform: uppercase;
    font-weight: 600;
    color: var(--ink-soft);
  }

  .join-landing h1 {
    margin: 0;
    font-size: clamp(2.15rem, 5vw, 4rem);
    line-height: 0.95;
    letter-spacing: -0.02em;
    max-width: 14ch;
    text-wrap: balance;
  }

  .join-lede {
    margin: 0;
    max-width: 40ch;
    font-size: clamp(1.08rem, 1.45vw, 1.35rem);
    line-height: 1.32;
    color: var(--ink);
  }

  .join-cta-row {
    display: flex;
    flex-wrap: wrap;
    align-items: center;
    gap: var(--space-2);
  }

  .join-cta-stack {
    display: grid;
    gap: 0.4rem;
    margin-top: 0.35rem;
  }

  .join-cta {
    min-height: 3.2rem;
    min-width: 12rem;
    padding-inline: 1.35rem;
    font-size: clamp(1.05rem, 1.4vw, 1.22rem);
    font-weight: 700;
    letter-spacing: 0.01em;
  }

  .join-cta-fallback {
    margin: 0;
  }

  .join-landing .panel-shell {
    padding: clamp(1.1rem, 2vw, 1.55rem);
    display: grid;
    gap: 0.62rem;
    align-content: start;
  }

  .join-panel-title {
    margin: 0;
    font-size: clamp(1.45rem, 2.2vw, 2.2rem);
    line-height: 1.08;
    text-wrap: balance;
  }

  .join-scope-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(min(100%, 15.5rem), 1fr));
    gap: 0.42rem;
  }

  .join-scope-grid .proof-chip {
    justify-content: flex-start;
    align-items: flex-start;
    white-space: normal;
    overflow: visible;
    text-overflow: clip;
    overflow-wrap: anywhere;
    padding: 0.4rem 0.68rem;
    font-size: 0.88rem;
    line-height: 1.28;
    min-height: 2.75rem;
  }

  .join-impact-label {
    margin-top: 0.25rem;
    margin-bottom: 0;
    font-size: 0.9rem;
    color: var(--ink-soft);
    font-weight: 600;
  }

  .join-impact {
    margin: 0;
    font-size: clamp(1.04rem, 1.2vw, 1.2rem);
    line-height: 1.35;
    max-width: 46ch;
  }

  @media (max-width: 920px) {
    .join-landing {
      grid-template-columns: 1fr;
      max-width: min(780px, calc(100vw - 1.2rem));
    }

    .join-landing .hero-shell::before {
      top: -3.5rem;
      right: -4rem;
      opacity: 0.36;
    }

    .join-landing .panel-shell {
      padding: 1.15rem;
    }
  }

  @media (max-width: 560px) {
    .join-landing {
      max-width: calc(100vw - 1rem);
    }

    .join-landing .hero-shell {
      padding: 1.18rem;
    }

    .join-cta-row {
      width: 100%;
    }

    .join-cta {
      width: 100%;
      justify-content: center;
    }

    .join-scope-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
