---
import BaseLayout from '../layouts/BaseLayout.astro';
import CardGrid from '../components/CardGrid.astro';
import TagList from '../components/TagList.astro';
import { loadLastModifiedISO, loadWorkshops } from '../lib/content';
import {
  getCoreWorkshopCatalog,
  getWorkshopReplayLinks,
  getWorkshopSlideLinks,
  type LearnCard,
} from '../lib/learn-pages';

const workshops = await loadWorkshops();
const updated = await loadLastModifiedISO('workshops.json');

const updatedLabel = updated
  ? new Date(updated).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
  : 'Not available';

const coreWorkshops: LearnCard[] = getCoreWorkshopCatalog(workshops);
const replayReadyWorkshops = getWorkshopReplayLinks(workshops);
const slidesReadyWorkshops = getWorkshopSlideLinks(workshops);
---
<BaseLayout title="Workshops - Oscar Sanchez" description="Delivery workshops with proof-backed content.">
  <div class="page-shell">
    <section class="panel-shell learn-hero" data-motion-enter>
      <p class="eyebrow learn-hero__eyebrow">
        <span class="learn-hero__dot" aria-hidden="true"></span>
        Learn
      </p>
      <h1>Workshops</h1>
      <p class="learn-hero__subtitle">Delivery sessions. Proof first. Low noise.</p>
      <div class="learn-hero__proof">
        <span class="learn-hero__chip" aria-label={`Last updated ${updatedLabel}`}>Last updated: {updatedLabel}</span>
      </div>
      <nav class="learn-hero__actions" aria-label="Jump to workshop sections">
        <a class="button" href="/visual-classes">Visual classes</a>
        <a class="button" href="#workshops">Workshops</a>
      </nav>
    </section>

    <nav class="learn-filter-row" aria-label="Quick workshop views" data-motion-enter>
      <a class="chip" href="#workshops">Newest first</a>
      <a class="chip" href="#workshops-replays">Replays available</a>
      <a class="chip" href="#workshops-slides">Slides</a>
    </nav>

    <section id="workshops" class="panel-shell">
      <h2>Workshops</h2>
      {coreWorkshops.length === 0 ? (
        <p class="text-small">No workshop entries yet.</p>
      ) : (
        <CardGrid gap="var(--space-3)" align="start">
          {coreWorkshops.map(({ cta, title, meta, proof, tags }, index) => {
            return (
              <article class="card learn-card cog-entrance" style={`--reveal-delay:${index * 45}ms;`}>
                <p class="text-small learn-card__meta">{meta}</p>
                <h3>{title}</h3>
                <p class="learn-card__proof-label">
                  <span class="learn-card__proof-dot" aria-hidden="true"></span>
                  Proof
                </p>
                <p class="text-small learn-card__proof">{proof}</p>
                <TagList tags={tags} compact maxItems={3} />
                <div class="learn-card__actions">
                  <a
                    class="button catalog-cta"
                    href={cta.href}
                    target={cta.isExternal ? '_blank' : undefined}
                    rel={cta.isExternal ? 'noopener noreferrer' : undefined}
                  >
                    {cta.label}
                  </a>
                </div>
              </article>
            );
          })}
        </CardGrid>
      )}
    </section>

    <section id="workshops-replays" class="panel-shell learn-filter-section" data-motion-enter>
      <h2>Replays available</h2>
      {replayReadyWorkshops.length === 0 ? (
        <p class="text-small muted">No replay links published yet.</p>
      ) : (
        <ul class="learn-filter-list">
          {replayReadyWorkshops.map((item) => (
            <li>
              <a class="learn-filter-link" href={item.href} target="_blank" rel="noopener noreferrer">
                <span class="text-small muted">{item.date}</span>
                <span>{item.title}</span>
              </a>
            </li>
          ))}
        </ul>
      )}
    </section>

    <section id="workshops-slides" class="panel-shell learn-filter-section" data-motion-enter>
      <h2>Slides</h2>
      {slidesReadyWorkshops.length === 0 ? (
        <p class="text-small muted">No slides links published yet.</p>
      ) : (
        <ul class="learn-filter-list">
          {slidesReadyWorkshops.map((item) => (
            <li>
              <a class="learn-filter-link" href={item.href} target="_blank" rel="noopener noreferrer">
                <span class="text-small muted">{item.date}</span>
                <span>{item.title}</span>
              </a>
            </li>
          ))}
        </ul>
      )}
    </section>
  </div>
</BaseLayout>
