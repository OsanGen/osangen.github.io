---
import BaseLayout from '../layouts/BaseLayout.astro';
import CardGrid from '../components/CardGrid.astro';
import { loadLastModifiedISO, loadModules, loadWorkshops } from '../lib/content';
import { getVisualClassCatalog, LEARN_VISUAL_ROUTE_LABEL, type LearnCard } from '../lib/learn-pages';

const [modules, workshops] = await Promise.all([loadModules(), loadWorkshops()]);
const updated = await loadLastModifiedISO('workshops.json');

const visualClassCards: LearnCard[] = getVisualClassCatalog(modules, workshops);

const updatedLabel = updated
  ? new Date(updated).toLocaleDateString('en-US', { month: 'short', day: 'numeric', year: 'numeric' })
  : 'Not available';
---
<BaseLayout title={`${LEARN_VISUAL_ROUTE_LABEL} - Oscar Sanchez`} description="Structured visual classes and practical proofs.">
  <div class="page-shell">
    <section class="panel-shell learn-hero cog-proof-stack" data-motion-enter>
      <p class="eyebrow learn-hero__eyebrow">
        <span class="learn-hero__dot" aria-hidden="true"></span>
        Learn
      </p>
      <h1>{LEARN_VISUAL_ROUTE_LABEL}</h1>
      <p class="learn-hero__subtitle">Structured classes with practical proof and low noise.</p>
      <div class="learn-hero__proof">
        <span class="learn-hero__chip" aria-label={`Last updated ${updatedLabel}`}>Last updated: {updatedLabel}</span>
      </div>
      <nav class="learn-hero__actions" aria-label="Jump to visual class sections">
        <a class="button" href="#visual-class-catalog">Browse {LEARN_VISUAL_ROUTE_LABEL.toLowerCase()}</a>
        <a class="button" href="/workshops">Workshops</a>
      </nav>
    </section>

    <section id="visual-class-catalog" class="panel-shell" data-motion-enter>
      <h2>Catalog</h2>
      {visualClassCards.length === 0 ? (
        <p class="text-small">No {LEARN_VISUAL_ROUTE_LABEL.toLowerCase()} are published yet.</p>
      ) : (
        <CardGrid gap="var(--space-3)" align="start" motionGroup>
          {visualClassCards.map(({ cta, title, meta, proof }, index) => (
            <article class="card learn-card cog-entrance cog-accent-rail" style={`--reveal-delay:${index * 45}ms;`}>
              <p class="text-small learn-card__meta">{meta}</p>
              <h3>{title}</h3>
              <p class="learn-card__proof-label cog-proof-chip">
                <span class="learn-card__proof-dot" aria-hidden="true"></span>
                Proof
              </p>
              <p class="text-small learn-card__proof">{proof}</p>
              <div class="learn-card__actions">
                <a
                  class="button catalog-cta"
                  href={cta.href}
                  target={cta.isExternal ? '_blank' : undefined}
                  rel={cta.isExternal ? 'noopener noreferrer' : undefined}
                >
                  {cta.label}
                </a>
              </div>
            </article>
          ))}
        </CardGrid>
      )}
    </section>
  </div>
</BaseLayout>
