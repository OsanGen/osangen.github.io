---
import BaseLayout from '../../layouts/BaseLayout.astro';
import type { Workshop } from '../../lib/schemas';
import { loadWorkshops } from '../../lib/content';

export async function getStaticPaths() {
  const workshops = await loadWorkshops();
  return workshops.map((workshop: Workshop) => ({
    params: {
      id: workshop.id,
    },
    props: {
      workshop,
    },
  }));
}

const { workshop } = Astro.props as { workshop?: Workshop };
const actionHref = workshop?.replayUrl || workshop?.slidesUrl;
const actionLabel = workshop?.replayUrl ? 'Replay' : 'Slides';
const actionIsExternal = actionHref ? /^https?:\/\//i.test(actionHref) : false;
---
<BaseLayout title={workshop ? `${workshop.title} | Oscar Sanchez` : 'Workshop not found'} description={workshop ? workshop.description : 'Workshop details'}>
  {workshop ? (
    <div class="page-shell">
      <section class="hero-shell scene-shell command-shell scene-accent" style="--scene-accent: var(--cog-blue);">
        <p class="hero-eyebrow">Workshop detail</p>
        <h1>{workshop.title}</h1>
        <p class="text-small deck-subtitle">{workshop.date}</p>
      </section>

      <section class="panel-shell">
        <h2>Description</h2>
        <p class="text-small">{workshop.description}</p>
      </section>

      <section class="panel-shell">
        <details class="agent-details" open>
          <summary>Proof + teaching notes</summary>
          <div class="agent-details-body">
            {workshop.proofLine ? <p>{workshop.proofLine}</p> : null}
            {workshop.teachingBullets && workshop.teachingBullets.length > 0 ? (
              <ol>
                {workshop.teachingBullets.map((bullet) => (
                  <li>{bullet}</li>
                ))}
              </ol>
            ) : null}
          </div>
        </details>
      </section>

      {actionHref ? (
        <section class="panel-shell">
          <h2>Play</h2>
          <a
            class="button button--primary"
            href={actionHref}
            target={actionIsExternal ? '_blank' : undefined}
            rel={actionIsExternal ? 'noopener noreferrer' : undefined}
          >
            {actionLabel}
          </a>
        </section>
      ) : null}

      <section class="panel-shell">
        <a class="button" href="/workshops">Back to Learn</a>
      </section>
    </div>
  ) : (
    <section class="panel-shell">
      <h1>Workshop not found</h1>
      <p class="text-small">This workshop is not available yet.</p>
      <a class="button" href="/workshops">Back to Learn</a>
    </section>
  )}
</BaseLayout>
