---
import BaseLayout from '../layouts/BaseLayout.astro';
import Card from '../components/Card.astro';
import CardGrid from '../components/CardGrid.astro';
import { loadCommunities, loadGames, loadModules, loadWorkshops } from '../lib/content';

const [games, modules, workshops, communities] = await Promise.all([
  loadGames(),
  loadModules(),
  loadWorkshops(),
  loadCommunities(),
]);

const visualClassCount = modules.filter((module) => Boolean(module.visualClass)).length;
const routeCards = [
  {
    title: 'Labs',
    href: '/labs',
    subtitle: `${games.length} game ${games.length === 1 ? 'lab' : 'labs'}`,
    action: 'Open labs',
  },
  {
    title: 'Learn',
    href: '/workshops',
    subtitle: `${workshops.length} workshop${workshops.length === 1 ? '' : 's'}`,
    action: 'Open learn',
  },
  {
    title: 'Join',
    href: '/join',
    subtitle: `${communities.length} community${communities.length === 1 ? '' : 's'}`,
    action: 'Join community',
  },
];

const bookHref = 'https://calendly.com/abellou/30min';
---
<BaseLayout title="Oscar Sanchez" description="Open-source AI education, cleanly.">
  <section class="hero-shell scene-shell scene-accent command-shell">
    <p class="hero-eyebrow">Open-source AI education</p>
    <h1>Choose your route. Learn fast.</h1>
    <p class="text-small deck-subtitle">Three clean paths for shipping AI capability: play, learn, and join.</p>
    <div class="cta-stack">
      <a class="button button--primary" href="/labs">Open Labs</a>
      <a class="button" href={bookHref} target="_blank" rel="noopener noreferrer">Book</a>
    </div>
    <p class="muted">Plus {visualClassCount} {visualClassCount === 1 ? 'visual class' : 'visual classes'} and growing public content.</p>
  </section>

  <div class="route-grid" style="--scene-accent: var(--cog-blue);">
    <CardGrid gap="var(--space-3)" align="start">
      {routeCards.map((card, index) => (
        <Card>
          <article
            class="route-card cog-entrance"
            style={`--reveal-delay:${index * 60}ms;`}
          >
            <h2>{card.title}</h2>
            <p class="text-small line-clamp-1">{card.subtitle}</p>
            <a class="button" href={card.href}>
              {card.action}
            </a>
          </article>
        </Card>
      ))}
    </CardGrid>
  </div>
</BaseLayout>
