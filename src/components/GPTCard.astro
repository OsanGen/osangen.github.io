---
import TagList from './TagList.astro';
import type { GPT } from '../lib/schemas';
import { isExternalUrl } from '../lib/link-utils';

export interface Props {
  gpt: GPT;
  revealDelayMs?: number;
  sceneAccent?: string;
}

const { gpt, revealDelayMs = 0, sceneAccent } = Astro.props;
const linkHref = gpt.link.trim();
const isExternal = isExternalUrl(linkHref);
const accentToken = sceneAccent || 'var(--scene-accent, var(--page-accent, var(--accent))';
---
<article
  class="panel-shell panel-shell--command agent-card agent-card--directory cog-entrance cog-accent-rail"
  style={`--reveal-delay:${revealDelayMs}ms; --scene-accent:${accentToken}; --route-accent:${accentToken};`}
>
  <div class="gpt-title-row">
    {gpt.icon ? <img src={gpt.icon.src} alt={gpt.icon.alt} class="gpt-icon" loading="lazy" decoding="async" /> : null}
    <h2>{gpt.name}</h2>
  </div>
  <p class="agent-summary line-clamp-2">
    <strong class="agent-label">Outcome:</strong> {gpt.ships}
  </p>

  <TagList tags={gpt.tags} compact maxItems={3} />

  <div class="cta-stack agent-actions">
      <a
        href={linkHref}
        class="button button--primary"
        target={isExternal ? '_blank' : undefined}
        rel={isExternal ? 'noopener noreferrer' : undefined}
      >
      Open
      </a>
  </div>
</article>
