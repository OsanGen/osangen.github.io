---
import { PRIMARY_NAV_ITEMS, isNavItemCurrent } from '../lib/site-nav';

const ctaHref = 'https://calendly.com/abellou/30min';
const currentPath = Astro.url.pathname;
---
<header class="site-header">
  <div class="container header-inner">
    <a class="brand brand-lockup" href="/" aria-label="OSAN home">
      <img
        class="brand-lockup-image"
        src="/icons/osan-logo-v2.png?v=2026-02-24"
        srcset="/icons/osan-logo-v2.png?v=2026-02-24 1x, /icons/osan-logo-v2@2x.png?v=2026-02-24 2x"
        sizes="(max-width: 760px) 8.6rem, 11rem"
        alt="OSAN"
        loading="eager"
        width="176"
        height="41"
        decoding="async"
        fetchpriority="high"
        data-logo-fallback-src="/icons/oscar-cog-brain.svg"
      />
    </a>
    <div class="header-right">
      <nav class="site-nav" aria-label="Primary">
        {PRIMARY_NAV_ITEMS.map((item) => {
          const isCurrent = isNavItemCurrent(currentPath, item.href);
          return (
            <a href={item.href} class="nav-link" aria-current={isCurrent ? 'page' : undefined}>
              {item.label}
            </a>
          );
        })}
      </nav>
      <a
        class="button button--primary nav-cta"
        href={ctaHref}
        target="_blank"
        rel="noopener noreferrer"
      >
        Book
      </a>
    </div>
  </div>
</header>
<script is:inline>
  (() => {
    const logos = document.querySelectorAll('.brand-lockup-image[data-logo-fallback-src]');
    for (const node of logos) {
      if (!(node instanceof HTMLImageElement)) continue;
      if (node.dataset.logoBound === '1') continue;

      const fallbackSrc = node.dataset.logoFallbackSrc;
      if (!fallbackSrc) continue;

      node.dataset.logoBound = '1';
      node.addEventListener('error', () => {
        if (node.dataset.logoFallback === '1') return;
        node.dataset.logoFallback = '1';
        node.classList.add('brand-lockup-image--fallback');
        node.src = fallbackSrc;
      });
    }
  })();
</script>
